<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squit Up - Connect & Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            onAuthStateChanged, 
            signOut 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            setDoc, 
            updateDoc, 
            query, 
            where, 
            collection, 
            getDocs, 
            addDoc 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // --------------------------------------------------------------------------------
        // 1. Firebase Configuration and Initialization
        // --------------------------------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyB1zvVHaBrbzX5iA9fBVNGa_3sY1-WCSpY",
            authDomain: "squit-up-auth.firebaseapp.com",
            projectId: "squit-up-auth",
            storageBucket: "squit-up-auth.firebasestorage.app",
            messagingSenderId: "503910898443",
            appId: "1:503910898443:web:c5a56eb24cd4f183d8600e",
            measurementId: "G-K4LHFHSNJC"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // Request Gmail access (optional, but keep it if required by your app)
        provider.addScope('https://www.googleapis.com/auth/gmail.readonly');

        // Export necessary functions/objects to window for use in global scope (e.g., HTML event handlers or console)
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.googleProvider = provider;
        window.signInWithPopup = signInWithPopup; // Exported for sign-in logic
        window.onAuthStateChanged = onAuthStateChanged;
        window.signOutUser = () => signOut(auth).then(() => console.log('User signed out')).catch(error => console.error(error)); // Simplified signOut function
        window.doc = doc;
        window.getDoc = getDoc;
        window.setDoc = setDoc;
        window.updateDoc = updateDoc;
        window.query = query;
        window.where = where;
        window.collection = collection;
        window.getDocs = getDocs;
        window.addDoc = addDoc;
        
        // --------------------------------------------------------------------------------
        // 2. Utility Functions for UI
        // --------------------------------------------------------------------------------
        
        const getElement = (id) => document.getElementById(id);

        const showScreen = (screenId) => {
            const screens = ['signInScreen', 'userIdScreen', 'dashboardScreen'];
            screens.forEach(id => {
                const screen = getElement(id);
                if (screen) {
                    screen.classList.add('hidden');
                    screen.classList.remove('flex');
                }
            });
            const targetScreen = getElement(screenId);
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
                targetScreen.classList.add('flex');
                // Ensure dashboard is full height
                if(screenId === 'dashboardScreen') {
                    targetScreen.classList.add('h-full');
                } else {
                    targetScreen.classList.remove('h-full');
                }
            }
        };

        const updateDashboardUI = (user, userData) => {
            getElement('dashboardUserAvatar').src = user.photoURL || 'https://via.placeholder.com/32';
            getElement('dashboardUserDisplayName').textContent = userData.displayName || user.displayName || 'User';
            getElement('dashboardUserStatus').textContent = `@${userData.userId || 'unknown'}`;
            getElement('welcomeEmail').textContent = user.email;
        };
        
        // --------------------------------------------------------------------------------
        // 3. Authentication Logic
        // --------------------------------------------------------------------------------

        /**
         * The corrected function to handle the Google Sign-In process.
         * This is what gets called when the button is pressed.
         */
        const signInWithGoogle = async () => {
            const signInBtn = getElement('googleSignInBtn');
            const loadingIndicator = getElement('loadingIndicator');
            
            // Show loading and disable button
            signInBtn.disabled = true;
            signInBtn.classList.add('opacity-50');
            loadingIndicator.classList.remove('hidden');

            try {
                // This is the call that opens the pop-up window
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                
                // Check if user document exists in Firestore (to see if they have a userId)
                const userDocRef = doc(db, "users", user.uid);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists() && userDoc.data().userId) {
                    // User exists and has a userId -> go to Dashboard
                    showScreen('dashboardScreen');
                    updateDashboardUI(user, userDoc.data());
                } else {
                    // New user or existing user without a userId -> go to User ID Creation
                    showScreen('userIdScreen');
                }

            } catch (error) {
                console.error("Google Sign-In Error:", error.code, error.message);
                
                let errorMessage = "An unknown error occurred.";
                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = "Sign-in popup closed. Please try again.";
                } else if (error.code === 'auth/cancelled-popup-request') {
                    errorMessage = "Another sign-in request is already in progress. Wait a moment and try again.";
                } else if (error.code === 'auth/operation-not-allowed') {
                    errorMessage = "Email/Password accounts are not enabled.";
                } else if (error.code === 'auth/account-exists-with-different-credential') {
                    errorMessage = "Account already exists with a different sign-in method.";
                } else {
                    // The common error is the popup blocker, which usually doesn't have a unique code.
                    errorMessage = "Sign-in failed. Please check if your browser blocked a popup window.";
                }
                
                alert(`Sign-In Failed: ${errorMessage}`);

            } finally {
                // Hide loading and re-enable button
                signInBtn.disabled = false;
                signInBtn.classList.remove('opacity-50');
                loadingIndicator.classList.add('hidden');
            }
        };
        
        // Export to window for event listener to find it
        window.signInWithGoogle = signInWithGoogle; 

        /**
         * Listener to check the authentication state when the page loads
         */
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // User is signed in
                const userDocRef = doc(db, "users", user.uid);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists() && userDoc.data().userId) {
                    // User has a userId, show dashboard
                    showScreen('dashboardScreen');
                    updateDashboardUI(user, userDoc.data());
                } else {
                    // User is signed in but needs to create a userId
                    showScreen('userIdScreen');
                }
            } else {
                // User is signed out, show sign-in screen
                showScreen('signInScreen');
            }
        });
        
        // --------------------------------------------------------------------------------
        // 4. User ID Creation Logic (Placeholder for full implementation)
        // --------------------------------------------------------------------------------

        const createUserId = async () => {
            const user = auth.currentUser;
            const userIdInput = getElement('userIdInput').value.trim().toLowerCase();
            const createBtn = getElement('createUserIdBtn');
            const creatingIndicator = getElement('creatingIndicator');
            const errorMessageDiv = getElement('errorMessage');
            const errorMessageP = errorMessageDiv.querySelector('p');
            
            errorMessageDiv.classList.add('hidden');
            
            if (!user) {
                errorMessageP.textContent = "Not signed in. Please sign in again.";
                errorMessageDiv.classList.remove('hidden');
                return;
            }

            if (!/^[a-z0-9_]{3,20}$/.test(userIdInput)) {
                errorMessageP.textContent = "User ID must be 3-20 characters long and only contain letters, numbers, or underscores.";
                errorMessageDiv.classList.remove('hidden');
                return;
            }

            createBtn.disabled = true;
            creatingIndicator.classList.remove('hidden');
            
            try {
                // 1. Check if userId is already taken
                const q = query(collection(db, "users"), where("userId", "==", userIdInput));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    errorMessageP.textContent = "This User ID is already taken. Please choose another one.";
                    errorMessageDiv.classList.remove('hidden');
                    return;
                }

                // 2. Create the user document
                await setDoc(doc(db, "users", user.uid), {
                    userId: userIdInput,
                    displayName: user.displayName || user.email.split('@')[0],
                    email: user.email,
                    photoURL: user.photoURL,
                    createdAt: new Date().toISOString()
                }, { merge: true });

                // Success!
                getElement('successMessage').classList.remove('hidden');
                
                // Wait a moment and then go to the dashboard
                setTimeout(() => {
                    showScreen('dashboardScreen');
                    updateDashboardUI(user, { userId: userIdInput, displayName: user.displayName });
                }, 1500);

            } catch (error) {
                console.error("User ID Creation Error:", error);
                errorMessageP.textContent = `Error creating user ID: ${error.message}`;
                errorMessageDiv.classList.remove('hidden');
            } finally {
                createBtn.disabled = false;
                creatingIndicator.classList.add('hidden');
            }
        };
        
        // Export and attach event listener for User ID creation button
        window.createUserId = createUserId; 
        
        // --------------------------------------------------------------------------------
        // 5. DOM Event Listeners (The FIX for the Sign-In button)
        // --------------------------------------------------------------------------------

        document.addEventListener('DOMContentLoaded', () => {
            const googleSignInBtn = getElement('googleSignInBtn');
            const createUserIdBtn = getElement('createUserIdBtn');
            
            // FIX: Attach the event listener to the Google Sign-In button
            if (googleSignInBtn) {
                googleSignInBtn.addEventListener('click', signInWithGoogle);
            }
            
            // Attach the event listener for the Create User ID button
            if (createUserIdBtn) {
                createUserIdBtn.addEventListener('click', createUserId);
            }
        });

        // --------------------------------------------------------------------------------
        // 6. Placeholder Functions (to prevent errors in the HTML)
        // --------------------------------------------------------------------------------
        window.selectServer = (server) => console.log(`Selected server: ${server}`);
        window.showCreateServer = () => console.log('Show create server modal');
        window.showServerMenu = () => console.log('Show server menu');
        window.showCreateChannel = (type) => console.log(`Show create ${type} channel modal`);
        window.selectChannel = (channel, type) => console.log(`Selected ${type} channel: ${channel}`);
        window.showUserSettings = () => getElement('userSettingsModal').classList.remove('hidden');
        window.showMembersList = () => console.log('Show members list');
        window.showChannelSettings = () => console.log('Show channel settings');
        window.sendMessage = () => {
            const input = getElement('messageInput');
            if (input.value.trim()) {
                console.log(`Sending message: ${input.value}`);
                // In a real app, you would send this to Firestore
                input.value = '';
            }
        };
        window.handleMessageInput = (event) => {
            if (event.key === 'Enter') {
                window.sendMessage();
            }
        };
        window.showAddFriend = () => console.log('Show add friend modal');
        window.startDM = (friend) => console.log(`Start DM with: ${friend}`);
        window.closeModal = (id) => getElement(id).classList.add('hidden');
        window.changeAvatar = () => console.log('Change avatar functionality');

    </script>
    <style>
        /* ... Your CSS styles remain here ... */
    </style>
</head>
<body class="gradient-bg min-h-full">
    <div id="signInScreen" class="min-h-full flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 max-w-md w-full text-center slide-in">
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-white mb-2">Squit Up</h1>
                <p class="text-white/80 text-lg">Connect, Chat, Community</p>
            </div>
            
            <div class="mb-8">
                <div class="w-20 h-20 mx-auto mb-4 bg-white/20 rounded-full flex items-center justify-center">
                    <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                </div>
                <p class="text-white/90 text-sm leading-relaxed">
                    Sign in with your Google account to access Squit Up. We need Gmail access to ensure account security and provide personalized features.
                </p>
            </div>

            <button id="googleSignInBtn" class="w-full bg-white hover:bg-gray-50 text-gray-800 font-semibold py-3 px-6 rounded-lg flex items-center justify-center space-x-3 transition-all duration-200 transform hover:scale-105 shadow-lg">
                <svg class="w-5 h-5" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                <span>Continue with Google</span>
            </button>

            <div id="loadingIndicator" class="hidden mt-4">
                <div class="flex items-center justify-center space-x-2 text-white/80">
                    <div class="w-4 h-4 bg-white/60 rounded-full pulse-animation"></div>
                    <span>Signing you in...</span>
                </div>
            </div>
        </div>
    </div>

    <div id="userIdScreen" class="hidden min-h-full flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 max-w-md w-full slide-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 mx-auto mb-4 bg-white/20 rounded-full flex items-center justify-center">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-white mb-2">Create Your User ID</h2>
                <p class="text-white/80 text-sm">Choose a unique @user_id to connect with friends</p>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-white/90 text-sm font-medium mb-2">Your User ID</label>
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 font-medium">@</span>
                        <input 
                            type="text" 
                            id="userIdInput" 
                            class="w-full pl-8 pr-4 py-3 bg-white/90 border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent"
                            placeholder="your_unique_id"
                            maxlength="20"
                        >
                    </div>
                    <p class="text-white/70 text-xs mt-1">Only letters, numbers, and underscores allowed</p>
                </div>

                <div id="errorMessage" class="hidden bg-red-500/20 border border-red-500/30 rounded-lg p-3">
                    <p class="text-red-200 text-sm">User ID is not valid.</p>
                </div>

                <div id="successMessage" class="hidden bg-green-500/20 border border-green-500/30 rounded-lg p-3">
                    <p class="text-green-200 text-sm">User ID created! Redirecting to dashboard...</p>
                </div>

                <button id="createUserIdBtn" class="w-full bg-white hover:bg-gray-50 text-gray-800 font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg">
                    Create Account
                </button>

                <div id="creatingIndicator" class="hidden text-center">
                    <div class="flex items-center justify-center space-x-2 text-white/80">
                        <div class="w-4 h-4 bg-white/60 rounded-full pulse-animation"></div>
                        <span>Creating your account...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboardScreen" class="hidden h-full bg-gray-800 text-white">
        <div class="flex h-full">
            <div class="w-16 sidebar-dark flex flex-col items-center py-3 space-y-2">
                <div class="w-12 h-12 bg-indigo-600 rounded-2xl hover:rounded-xl transition-all duration-200 flex items-center justify-center cursor-pointer hover-lift" onclick="selectServer('home')">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                </div>
                
                <div class="w-8 h-0.5 bg-gray-600 rounded"></div>
                
                <div class="w-12 h-12 bg-green-600 rounded-full hover:rounded-xl transition-all duration-200 flex items-center justify-center cursor-pointer hover-lift text-sm font-bold" onclick="selectServer('gaming')">
                    G
                </div>
                <div class="w-12 h-12 bg-purple-600 rounded-full hover:rounded-xl transition-all duration-200 flex items-center justify-center cursor-pointer hover-lift text-sm font-bold" onclick="selectServer('study')">
                    S
                </div>
                
                <div class="w-12 h-12 bg-gray-700 hover:bg-green-600 rounded-full hover:rounded-xl transition-all duration-200 flex items-center justify-center cursor-pointer hover-lift" onclick="showCreateServer()">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                </div>
            </div>

            <div class="w-60 bg-gray-700 flex flex-col">
                <div class="h-12 px-4 flex items-center justify-between border-b border-gray-600 cursor-pointer hover:bg-gray-600" onclick="showServerMenu()">
                    <h2 id="serverName" class="font-semibold">Squit Up Home</h2>
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z"/>
                    </svg>
                </div>

                <div class="flex-1 overflow-y-auto scrollbar-thin">
                    <div class="p-2">
                        <div class="flex items-center justify-between px-2 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wide">
                            <span>Text Channels</span>
                            <button onclick="showCreateChannel('text')" class="hover:text-white">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                            </button>
                        </div>
                        <div id="textChannels" class="space-y-1">
                            <div class="flex items-center px-2 py-1 rounded hover:bg-gray-600 cursor-pointer text-gray-300 hover:text-white" onclick="selectChannel('general', 'text')">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M7 14l5-5 5 5z"/>
                                </svg>
                                <span class="text-sm">general</span>
                            </div>
                            <div class="flex items-center px-2 py-1 rounded hover:bg-gray-600 cursor-pointer text-gray-300 hover:text-white" onclick="selectChannel('random', 'text')">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M7 14l5-5 5 5z"/>
                                </svg>
                                <span class="text-sm">random</span>
                            </div>
                        </div>
                    </div>

                    <div class="p-2">
                        <div class="flex items-center justify-between px-2 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wide">
                            <span>Voice Channels</span>
                            <button onclick="showCreateChannel('voice')" class="hover:text-white">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                            </button>
                        </div>
                        <div id="voiceChannels" class="space-y-1">
                            <div class="flex items-center px-2 py-1 rounded hover:bg-gray-600 cursor-pointer text-gray-300 hover:text-white" onclick="selectChannel('general-voice', 'voice')">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
                                </svg>
                                <span class="text-sm">General Voice</span>
                            </div>
                            <div class="flex items-center px-2 py-1 rounded hover:bg-gray-600 cursor-pointer text-gray-300 hover:text-white" onclick="selectChannel('music', 'voice')">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
                                </svg>
                                <span class="text-sm">Music Room</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="h-14 bg-gray-800 flex items-center px-2 space-x-2">
                    <div class="relative">
                        <img id="dashboardUserAvatar" src="https://via.placeholder.com/32" alt="Avatar" class="w-8 h-8 rounded-full">
                        <div class="absolute -bottom-1 -right-1 w-3 h-3 online-indicator rounded-full border-2 border-gray-800"></div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div id="dashboardUserDisplayName" class="text-sm font-medium truncate">Loading...</div>
                        <div id="dashboardUserStatus" class="text-xs text-gray-400 truncate">@loading</div>
                    </div>
                    <button onclick="showUserSettings()" class="p-1 hover:bg-gray-700 rounded">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                        </svg>
                    </button>
                    <button onclick="signOutUser()" class="p-1 hover:bg-gray-700 rounded text-red-400 hover:text-red-300">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="flex-1 flex flex-col">
                <div class="h-12 bg-gray-700 border-b border-gray-600 flex items-center px-4 justify-between">
                    <div class="flex items-center space-x-2">
                        <svg id="channelIcon" class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M7 14l5-5 5 5z"/>
                        </svg>
                        <h3 id="channelName" class="font-semibold">general</h3>
                        <span class="text-gray-400 text-sm">Welcome to the general channel!</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="showMembersList()" class="p-2 hover:bg-gray-600 rounded">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.54 8H17c-.8 0-1.54.37-2.01.99l-2.54 3.38c-.36.48-.85.63-1.37.63s-1.01-.15-1.37-.63L7.17 8.99A2.5 2.5 0 0 0 5.16 8H3.64a1.5 1.5 0 0 0-1.42.37L0 16h2.5v6h3V16h2v6h4V16h2v6h4z"/>
                            </svg>
                        </button>
                        <button onclick="showChannelSettings()" class="p-2 hover:bg-gray-600 rounded">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="flex-1 chat-area overflow-y-auto scrollbar-thin p-4" id="messagesContainer">
                    <div class="mb-4 p-4 bg-indigo-600/20 rounded-lg border border-indigo-500/30">
                        <h4 class="font-semibold text-indigo-300 mb-2">Welcome to Squit Up! ðŸŽ‰</h4>
                        <p class="text-sm text-gray-300">Start chatting with friends, join servers, and build your community. Your account is connected with <span id="welcomeEmail" class="font-medium text-indigo-300"></span></p>
                    </div>

                    <div id="messagesList" class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <img src="https://via.placeholder.com/40" alt="Avatar" class="w-10 h-10 rounded-full">
                            <div>
                                <div class="flex items-center space-x-2 mb-1">
                                    <span class="font-semibold text-white">SquitBot</span>
                                    <span class="text-xs text-gray-400">Today at 12:00 PM</span>
                                </div>
                                <p class="text-gray-300">Welcome to your new server! Start by inviting some friends or creating channels to organize your conversations.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-4">
                    <div class="message-input rounded-lg flex items-center space-x-3 p-3">
                        <button class="text-gray-400 hover:text-white">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                        </button>
                        <input 
                            type="text" 
                            id="messageInput" 
                            placeholder="Message #general" 
                            class="flex-1 bg-transparent text-white placeholder-gray-400 focus:outline-none"
                            onkeypress="handleMessageInput(event)"
                        >
                        <button onclick="sendMessage()" class="text-gray-400 hover:text-white">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div id="rightSidebar" class="w-60 bg-gray-700 border-l border-gray-600">
                <div class="h-12 px-4 flex items-center justify-between border-b border-gray-600">
                    <h3 class="font-semibold">Friends</h3>
                    <button onclick="showAddFriend()" class="text-green-500 hover:text-green-400">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </button>
                </div>

                <div class="p-3">
                    <div class="text-xs font-semibold text-gray-400 uppercase tracking-wide mb-2">Online â€” 3</div>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-3 p-2 rounded hover:bg-gray-600 cursor-pointer">
                            <div class="relative">
                                <img src="https://via.placeholder.com/32" alt="Friend" class="w-8 h-8 rounded-full">
                                <div class="absolute -bottom-1 -right-1 w-3 h-3 online-indicator rounded-full border-2 border-gray-700"></div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="text-sm font-medium truncate">Alex Johnson</div>
                                <div class="text-xs text-gray-400 truncate">Playing Valorant</div>
                            </div>
                            <button onclick="startDM('alex')" class="text-gray-400 hover:text-white">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="flex items-center space-x-3 p-2 rounded hover:bg-gray-600 cursor-pointer">
                            <div class="relative">
                                <img src="https://via.placeholder.com/32" alt="Friend" class="w-8 h-8 rounded-full">
                                <div class="absolute -bottom-1 -right-1 w-3 h-3 online-indicator rounded-full border-2 border-gray-700"></div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="text-sm font-medium truncate">Sarah Chen</div>
                                <div class="text-xs text-gray-400 truncate">Listening to Spotify</div>
                            </div>
                            <button onclick="startDM('sarah')" class="text-gray-400 hover:text-white">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="p-3">
                    <div class="text-xs font-semibold text-gray-400 uppercase tracking-wide mb-2">Offline â€” 2</div>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-3 p-2 rounded hover:bg-gray-600 cursor-pointer opacity-60">
                            <div class="relative">
                                <img src="https://via.placeholder.com/32" alt="Friend" class="w-8 h-8 rounded-full">
                                <div class="absolute -bottom-1 -right-1 w-3 h-3 offline-indicator rounded-full border-2 border-gray-700"></div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="text-sm font-medium truncate">Mike Wilson</div>
                                <div class="text-xs text-gray-400 truncate">Last seen 2 hours ago</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="userSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg w-full max-w-2xl max-h-full overflow-y-auto">
            <div class="flex items-center justify-between p-4 border-b border-gray-600">
                <h2 class="text-xl font-semibold">User Settings</h2>
                <button onclick="closeModal('userSettingsModal')" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="p-6 space-y-6">
                <div>
                    <h3 class="text-lg font-semibold mb-4">My Account</h3>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-4">
                            <img id="settingsAvatar" src="https://via.placeholder.com/80" alt="Avatar" class="w-20 h-20 rounded-full">
                            <div class="flex-1">
                                <button onclick="changeAvatar()" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded text-sm font-medium">
                                    Change Avatar
                                </button>
                                <p class="text-xs text-gray-400 mt-1">Recommended size: 128x128px</p>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Display Name</label>
                            <input type="text" id="displayNameInput" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-indigo-500">
                        </div>
                        </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
