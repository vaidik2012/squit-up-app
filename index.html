<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squit Up! Chat Platform</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --sidebar-width: 280px;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Darkest Blue-Gray */
            color: #f3f4f6; /* Light text */
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden; /* Remove global scroll */
        }

        /* Full screen layout for dashboard */
        .dashboard-layout {
            display: grid;
            grid-template-columns: var(--sidebar-width) 1fr;
            height: 100vh;
        }

        /* Custom Styles for Dashboard and Components */
        .sidebar {
            background-color: #1f2937; /* Slightly lighter dark gray */
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .main-content {
            background-color: #111827;
            display: flex;
            flex-direction: column;
            height: 100vh; /* Ensure it takes full height */
            overflow: hidden;
        }

        .sidebar-header {
            background-color: #1f2937;
            border-bottom: 1px solid #374151;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Profile Card Hover Effect */
        .profile-card:hover {
            box-shadow: 0 0 15px rgba(134, 49, 255, 0.5); /* Purple shadow on hover */
            cursor: pointer;
            transform: scale(1.01);
        }

        /* Section Header Styling (Dull Button Fix) */
        .sidebar-section-header {
            color: #f3f4f6; /* Bright white text */
            text-shadow: 0 0 5px rgba(134, 49, 255, 0.5); /* Subtle purple glow */
        }

        /* Button Styling (Large Button Fix) */
        .btn-primary {
            background-image: linear-gradient(145deg, #6366f1, #8b5cf6); /* Indigo to Violet gradient */
            color: #ffffff;
            font-weight: 600;
            border-radius: 0.5rem;
            padding: 0.5rem 1.25rem; /* Reduced padding for smaller size */
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-primary:hover {
            opacity: 0.9;
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background-color: #374151;
            color: #d1d5db;
            font-weight: 500;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            transition: background-color 0.3s ease;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
        }

        /* Chat Message Styling */
        .message-container {
            display: flex;
            flex-direction: column;
            padding: 1rem;
            overflow-y: auto; /* Scrollable chat area */
            flex-grow: 1;
        }

        .message-bubble {
            max-width: 70%;
            padding: 0.6rem 1rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
            word-wrap: break-word;
            font-size: 0.9rem;
        }

        .self-message {
            background-color: #4f46e5; /* Indigo */
            align-self: flex-end;
            border-bottom-right-radius: 0.2rem;
        }

        .friend-message {
            background-color: #374151; /* Dark Gray */
            align-self: flex-start;
            border-bottom-left-radius: 0.2rem;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .modal-content {
            background-color: #1f2937;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            max-width: 500px; /* Adjusted size for better feel */
            width: 90%;
            transition: transform 0.3s ease-out;
        }

        /* Loading Spinner Center Fix */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #111827;
            display: flex;
            flex-direction: column;
            justify-content: center; /* Center vertically */
            align-items: center; /* Center horizontally */
            z-index: 100;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #8b5cf6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Auth Container Sizing Fix */
        .auth-container {
            width: 100%; 
            max-width: 450px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

    </style>
</head>
<body>

    <!-- Main App Container -->
    <div id="app-container" class="hidden h-screen w-screen">
        <div id="dashboard-layout" class="dashboard-layout">
            <!-- Sidebar -->
            <div id="sidebar" class="sidebar"></div>
            <!-- Main Content Area -->
            <div id="main-content" class="main-content"></div>
        </div>
    </div>

    <!-- Modals go here -->
    <div id="modal-container"></div>
    
    <!-- Loading Screen -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner mb-4"></div>
        <p class="text-xl font-semibold">Starting SQUIT UP!</p>
    </div>

    <!-- Auth/Profile Setup View (Initially centered) -->
    <div id="auth-view-container" class="auth-container p-6 bg-gray-800 rounded-xl shadow-2xl transition-all duration-500 hidden"></div>

    <script type="module">
        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, where, arrayUnion, arrayRemove, setLogLevel, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        setLogLevel('Debug');

        // --- Global State ---
        let app, db, auth;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let appState = {
            userId: null,
            userProfile: null,
            friends: [],
            pendingRequests: [],
            sentRequests: [],
            usersList: [],
            view: 'loading', // 'loading', 'auth', 'dashboard'
            activeChatId: null, // UID of the friend currently chatting with
            chatMessages: {}, // Keyed by friendId: [{sender: uid, text: "msg", timestamp: "ISO"}] <-- NON-PERSISTENT
            isAuthReady: false
        };

        // Mock friend data for demo purposes
        const mockFriend = {
            uid: 'mock-friend-1234',
            displayName: 'GSA Bot',
            status: 'online',
            pfpUrl: 'https://placehold.co/40x40/4f46e5/ffffff?text=GSA',
            bio: 'Hello, I am a helpful AI friend!',
            pronouns: 'it/its'
        };

        // --- Utility Functions ---

        /** Shows a custom, transient alert message */
        function showCustomAlert(message, type = 'info') {
            const container = document.getElementById('modal-container');
            let bgColor, icon;

            if (type === 'success') {
                bgColor = 'bg-green-600';
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
            } else if (type === 'error') {
                bgColor = 'bg-red-600';
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            } else {
                bgColor = 'bg-indigo-600';
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            }

            const alertDiv = document.createElement('div');
            alertDiv.className = `fixed top-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-xl flex items-center space-x-3 transition-transform transform translate-x-full duration-300 z-50`;
            alertDiv.innerHTML = `${icon} <span>${message}</span>`;

            container.appendChild(alertDiv);

            // Animate in
            setTimeout(() => {
                alertDiv.classList.remove('translate-x-full');
            }, 10);

            // Animate out and remove
            setTimeout(() => {
                alertDiv.classList.add('translate-x-full');
                alertDiv.addEventListener('transitionend', () => alertDiv.remove());
            }, 3000);
        }

        // --- View Rendering ---

        /** Renders the entire application based on the current view state */
        function renderApp() {
            document.getElementById('loadingOverlay').classList.add('hidden');
            document.getElementById('app-container').classList.add('hidden');
            document.getElementById('auth-view-container').classList.add('hidden');
            
            if (appState.view === 'loading') {
                document.getElementById('loadingOverlay').classList.remove('hidden');
            } else if (appState.view === 'auth' || !appState.userProfile) {
                renderAuthView();
                document.getElementById('auth-view-container').classList.remove('hidden');
            } else if (appState.view === 'dashboard') {
                document.getElementById('app-container').classList.remove('hidden');
                renderDashboardView();
            }
        }

        function renderAuthView() {
            const container = document.getElementById('auth-view-container');
            if (appState.userProfile) {
                // Profile setup view
                container.innerHTML = `
                    <div class="text-center">
                        <h2 class="text-2xl font-bold mb-4 text-indigo-400">Welcome, ${appState.userProfile.email.split('@')[0]}!</h2>
                        <p class="text-gray-300 mb-6">Please complete your profile.</p>
                        <div class="bg-gray-700 p-6 rounded-lg space-y-4">
                            ${renderProfileForm(appState.userProfile, true)}
                            <button onclick="saveProfile()" class="btn-primary w-full">Save Profile and Enter SQUIT</button>
                        </div>
                        <button onclick="signOut()" class="text-gray-400 hover:text-red-400 mt-4 text-sm">Sign Out</button>
                    </div>
                `;
            } else {
                // Simple sign in/out view (Mock for now)
                 container.innerHTML = `
                    <div class="text-center">
                        <h2 class="text-4xl font-extrabold text-yellow-400 mb-8 tracking-wider">SQUIT UP! 🚀</h2>
                        <p class="text-gray-300 mb-6">Sign in to start chatting.</p>
                        <button onclick="signIn()" class="btn-primary w-full py-3 text-lg">Sign In with Google (Mock)</button>
                        <button onclick="signOut()" class="text-gray-400 hover:text-red-400 mt-4 text-sm">Sign Out</button>
                    </div>
                `;
            }
        }

        function renderProfileForm(profile, isSetup = false) {
            return `
                <div class="space-y-3">
                    <label class="block text-sm font-medium text-gray-300">Display Name</label>
                    <input id="displayNameInput" type="text" value="${profile.displayName || ''}" placeholder="Choose a unique display name" class="w-full p-2 rounded-lg bg-gray-600 border border-gray-500 text-white focus:ring-indigo-500">
                    
                    <label class="block text-sm font-medium text-gray-300">Bio (Status)</label>
                    <textarea id="bioInput" placeholder="What's on your mind? (Max 100 chars)" maxlength="100" class="w-full p-2 rounded-lg bg-gray-600 border border-gray-500 text-white focus:ring-indigo-500">${profile.bio || ''}</textarea>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-300">Pronouns</label>
                            <input id="pronounsInput" type="text" value="${profile.pronouns || ''}" placeholder="e.g. they/them" class="w-full p-2 rounded-lg bg-gray-600 border border-gray-500 text-white focus:ring-indigo-500">
                        </div>
                         <div>
                            <label class="block text-sm font-medium text-gray-300">Status</label>
                            <select id="statusInput" class="w-full p-2 rounded-lg bg-gray-600 border border-gray-500 text-white focus:ring-indigo-500">
                                <option value="online" ${profile.status === 'online' ? 'selected' : ''}>Online</option>
                                <option value="idle" ${profile.status === 'idle' ? 'selected' : ''}>Idle</option>
                                <option value="dnd" ${profile.status === 'dnd' ? 'selected' : ''}>Do Not Disturb</option>
                                <option value="offline" ${profile.status === 'offline' ? 'selected' : ''}>Offline</option>
                            </select>
                        </div>
                    </div>

                    <label class="block text-sm font-medium text-gray-300">PFP URL (PNG/JPG)</label>
                    <input id="pfpUrlInput" type="text" value="${profile.pfpUrl || ''}" placeholder="Image URL for profile picture" class="w-full p-2 rounded-lg bg-gray-600 border border-gray-500 text-white focus:ring-indigo-500">
                    
                    <label class="block text-sm font-medium text-gray-300">Banner URL (PNG/JPG)</label>
                    <input id="bannerUrlInput" type="text" value="${profile.bannerUrl || ''}" placeholder="Image URL for profile banner" class="w-full p-2 rounded-lg bg-gray-600 border border-gray-500 text-white focus:ring-indigo-500">
                </div>
            `;
        }
        
        function renderDashboardView() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            
            // --- Render Sidebar ---
            
            // 1. Profile Header
            const profile = appState.userProfile;
            const statusColor = profile.status === 'online' ? 'bg-green-500' : profile.status === 'idle' ? 'bg-yellow-500' : profile.status === 'dnd' ? 'bg-red-500' : 'bg-gray-500';

            sidebar.innerHTML = `
                <div class="sidebar-header flex justify-between items-center">
                    <h2 class="text-xl font-extrabold text-white">SQUIT!</h2>
                    <button onclick="openModal('addFriend')" class="text-gray-400 hover:text-white transition p-1 rounded-full hover:bg-[#374151]">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg>
                    </button>
                </div>

                <div class="flex-grow overflow-y-auto p-3 space-y-4">
                    
                    <!-- Pending Requests -->
                    <div class="space-y-2">
                        <p class="sidebar-section-header text-xs font-bold uppercase tracking-wider mb-2">Pending Requests (${appState.pendingRequests.length})</p>
                        ${appState.pendingRequests.length === 0 ? `<p class="text-xs text-gray-400 p-2">No pending requests.</p>` : appState.pendingRequests.map(req => `
                            <div class="flex items-center justify-between p-2 rounded-lg hover:bg-gray-700 transition">
                                <div class="text-sm text-gray-300">${req.displayName}</div>
                                <div class="space-x-2">
                                    <button onclick="acceptFriendRequest('${req.uid}')" class="text-green-400 hover:text-green-300">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                    </button>
                                    <button onclick="rejectFriendRequest('${req.uid}')" class="text-red-400 hover:text-red-300">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- Friends List -->
                    <div class="space-y-2">
                        <p class="sidebar-section-header text-xs font-bold uppercase tracking-wider mb-2">My Friends (${appState.friends.length})</p>
                        ${appState.friends.length === 0 ? `<p class="text-xs text-gray-400 p-2">Add friends to chat!</p>` : appState.friends.map(friend => `
                            <div onclick="setActiveChat('${friend.uid}')" 
                                class="flex items-center p-2 rounded-lg cursor-pointer transition 
                                ${appState.activeChatId === friend.uid ? 'bg-indigo-700/50' : 'hover:bg-gray-700'}">
                                
                                <div class="relative">
                                    <img src="${friend.pfpUrl || 'https://placehold.co/40x40/4f46e5/ffffff?text=U'}" alt="${friend.displayName}" class="w-10 h-10 rounded-full object-cover">
                                    <span class="absolute right-0 bottom-0 w-3 h-3 ${friend.status === 'online' ? 'bg-green-500' : 'bg-gray-500'} rounded-full border-2 border-[#1f2937]"></span>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-semibold text-white">${friend.displayName}</p>
                                    <p class="text-xs text-gray-400 truncate">${friend.bio || friend.status}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                </div>
                
                <!-- Profile Card Footer -->
                <div onclick="openModal('editProfile')" class="profile-card p-3 bg-gray-900 border-t border-gray-700 flex items-center transition duration-200">
                    <div class="relative">
                        <img src="${profile.pfpUrl || 'https://placehold.co/40x40/4f46e5/ffffff?text=U'}" alt="PFP" class="w-10 h-10 rounded-full object-cover">
                        <span class="absolute right-0 bottom-0 w-3 h-3 ${statusColor} rounded-full border-2 border-gray-900"></span>
                    </div>
                    <div class="ml-3 overflow-hidden flex-grow">
                        <p class="text-sm font-bold text-white truncate">${profile.displayName}</p>
                        <p class="text-xs text-gray-400 truncate">${profile.email}</p>
                    </div>
                    <!-- Sign Out Button (Icon only) -->
                    <button onclick="signOut(event)" class="text-gray-400 hover:text-white transition p-2 rounded-full hover:bg-[#374151]">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3v-4a3 3 0 013-3h4a3 3 0 013 3v1" />
                        </svg>
                    </button>
                </div>
            `;
            
            // --- Render Main Content ---
            if (appState.activeChatId) {
                renderChatView(mainContent, appState.activeChatId);
            } else {
                // Initial message when no chat is selected
                mainContent.innerHTML = `
                    <div class="flex flex-col justify-center items-center h-full text-gray-500 p-8">
                        <svg class="w-20 h-20 mb-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.549A9.957 9.957 0 0012 22c4.97 0 9-3.582 9-8s-4.03-8-9-8-9 3.582-9 8h.082a8.07 8.07 0 00.322 1.353v.065"></path></svg>
                        <h3 class="text-xl font-semibold mb-2 text-white">Select a Friend to Chat</h3>
                        <p class="text-center">Click on any friend in the sidebar to open a conversation and start messaging.</p>
                    </div>
                `;
            }
        }

        function renderChatView(container, friendUid) {
            const friend = appState.friends.find(f => f.uid === friendUid) || mockFriend;
            const messages = appState.chatMessages[friendUid] || [];
            const myUid = appState.userId;

            container.innerHTML = `
                <!-- Chat Header -->
                <div class="chat-header p-4 flex items-center bg-gray-800 border-b border-gray-700 shadow-md">
                    <img src="${friend.pfpUrl || 'https://placehold.co/40x40/4f46e5/ffffff?text=U'}" alt="${friend.displayName}" class="w-10 h-10 rounded-full object-cover">
                    <div class="ml-3">
                        <p class="text-lg font-bold text-white">${friend.displayName}</p>
                        <p class="text-xs text-gray-400">@${friend.uid.substring(0, 8)}</p>
                    </div>
                </div>

                <!-- Messages Container -->
                <div id="messagesContainer" class="message-container flex-grow overflow-y-auto">
                    ${messages.map(msg => `
                        <div class="flex ${msg.sender === myUid ? 'justify-end' : 'justify-start'}">
                            <div class="message-bubble ${msg.sender === myUid ? 'self-message' : 'friend-message'}">
                                ${msg.text}
                                <span class="block text-xs text-white/50 mt-1 text-right">${new Date(msg.timestamp).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <!-- Chat Input/Footer -->
                <div class="chat-footer p-4 flex items-center bg-gray-700/50">
                    <input type="text" id="chatInput" placeholder="Message to @${friend.displayName}..." 
                        class="flex-grow p-3 rounded-l-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150"
                        onkeypress="if(event.key === 'Enter') sendMessage(event)">
                    <button onclick="sendMessage(event)" class="btn-primary flex items-center space-x-2 rounded-r-lg shadow-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                        </svg>
                        <span>Send</span>
                    </button>
                </div>
            `;
            // Scroll to bottom immediately after rendering
            setTimeout(() => {
                const messagesContainer = document.getElementById('messagesContainer');
                if (messagesContainer) {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }, 50);
        }

        // --- Action Handlers ---

        // NEW: Local (Non-Persistent) sendMessage function
        window.sendMessage = function(event) {
            // Check if triggered by Enter keypress to prevent accidental form submission
            if (event.type === 'keypress' && event.key !== 'Enter') return;
            if (event.key === 'Enter' || event.type === 'click') event.preventDefault(); 
            
            const input = document.getElementById('chatInput');
            const messageText = input.value.trim();
            const receiverUid = appState.activeChatId;

            if (messageText === "" || !receiverUid) return;

            // This is the NON-PERSISTENT part: storing the message locally.
            const newMessage = {
                sender: appState.userId,
                text: messageText,
                timestamp: new Date().toISOString()
            };

            if (!appState.chatMessages[receiverUid]) {
                appState.chatMessages[receiverUid] = [];
            }
            appState.chatMessages[receiverUid].push(newMessage);

            // Clear the input and re-render
            input.value = "";
            renderDashboardView(); 
        }

        window.setActiveChat = function(friendUid) {
            appState.activeChatId = friendUid;
            renderDashboardView(); 
        }

        // --- Other Action functions (simplified for brevity) ---
        // (Other functions like openModal, closeModal, etc. were also present here)
        // ... (Functions for Friend Requests, Profile Edit, Auth were present)
        
        // --- Initialization ---

        async function initializeAppAndAuth() {
            // ... (Firebase initialization and auth logic)
            // ... (The actual initialization code was here)
        }
        
        // initializeAppAndAuth(); // Function call to start the app

    </script>
</body>
</html>
